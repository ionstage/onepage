!function t(e,n,i){function o(r,a){if(!n[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(s)return s(r,!0);var p=new Error("Cannot find module '"+r+"'");throw p.code="MODULE_NOT_FOUND",p}var l=n[r]={exports:{}};e[r][0].call(l.exports,function(t){var n=e[r][1][t];return o(n?n:t)},l,l.exports,t,e,n,i)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(t,e,n){!function(e){"use strict";var n=e.helper||t("./helper.js"),i=e.dom||t("./dom.js"),o=e.InsertForm||t("./components/insert-form.js"),s=e.Canvas||t("./components/canvas.js"),r=e.PublishForm||t("./components/publish-form.js"),a=e.PublishDialog||t("./components/publish-dialog.js"),h=e.URLComponent||t("./components/url-component.js"),p=function(){n.bindAll(this),this.insertForm=new o({element:i.el(".insert-form"),inserter:this.inserter}),this.canvas=new s({hasCanvasElementHandle:!0,element:i.el(".canvas"),inserter:this.inserter,updater:this.updater,deleter:this.deleter}),this.publishForm=new r({element:i.el(".publish-form"),updater:this.updater,publisher:this.publisher}),this.publishDialog=new a({element:i.el(".dialog"),closer:this.publishDialogCloser}),this.urlComponent=new h,this.loadURLFragment().then(this.saveURLFragment).then(this.updatePublishButton)};p.prototype.data=function(){return{title:this.publishForm.text(),list:this.canvas.getCanvasElementPropsList()}},p.prototype.inserter=function(t,e,i){this.insertForm.disabled(!0);var o=3===arguments.length;return this.canvas.loadCanvasElement(t,function(t){var n,s;return o?(n=e-t.width/2,s=i-t.height/2):(n=(this.canvas.width()-t.width)/2,s=t.height<this.canvas.height()-40?20:0),{x:n,y:s}}.bind(this),n.identity).then(function(){return o||this.insertForm.clearText(),this.saveURLFragment(this.data()).then(this.updatePublishButton)}.bind(this))["catch"](function(t){console.error(t),alert("Load error!")}.bind(this)).then(function(){this.insertForm.disabled(!1)}.bind(this))},p.prototype.updater=function(){this.saveURLFragment(this.data()).then(this.updatePublishButton)},p.prototype.deleter=function(){this.saveURLFragment(this.data()).then(this.updatePublishButton)},p.prototype.publisher=function(t){var e=t+" - OnePage",n=i.urlPathName().split("/");n[n.length-1]="viewer.html";var o=i.urlOrigin()+n.join("/")+"#"+this.urlComponent.fragment(),s=this.publishDialog;s.title(e),s.url(o),s.visible(!0)},p.prototype.publishDialogCloser=function(){this.publishDialog.visible(!1)},p.prototype.loadURLFragment=function(){var t,e=this.urlComponent.fragment();try{t=JSON.parse(i.atob(e.substring(1)))}catch(n){t={title:"",list:[]}}return this.publishForm.text(t.title),this.canvas.loadCanvasElementAll(t.list).then(function(){return this.data()}.bind(this))},p.prototype.saveURLFragment=function(t){var e=!t.title&&0===t.list.length,n="!"+(e?"":i.btoa(JSON.stringify(t)));return this.urlComponent.fragment(n),Promise.resolve(t)},p.prototype.updatePublishButton=function(t){var e=!t.title&&0===t.list.length;this.publishForm.publishDisabled(e)},e.main=new p}(this.app||(this.app={}))},{"./components/canvas.js":4,"./components/insert-form.js":6,"./components/publish-dialog.js":7,"./components/publish-form.js":8,"./components/url-component.js":10,"./dom.js":11,"./helper.js":12}],2:[function(t,e,n){!function(n){"use strict";var i=n.helper||t("../helper.js"),o=n.dom||t("../dom.js"),s=n.Component||t("./component.js"),r=i.inherits(function(t){r.super_.call(this),this.x=this.prop(0),this.y=this.prop(0),this.width=this.prop(0),this.height=this.prop(0),this.visible=this.prop(!1),this.stepForwardDisabled=this.prop(!1),this.stepBackwardDisabled=this.prop(!1),this.element=this.prop(t.element),this.mover=t.mover,this.deleter=t.deleter,this.forwardStepper=t.forwardStepper,this.backwardStepper=t.backwardStepper,this.resizer=t.resizer,this.onmove=r.prototype.onmove.bind(this),this.ondelete=r.prototype.ondelete.bind(this),this.onstepforward=r.prototype.onstepforward.bind(this),this.onstepbackward=r.prototype.onstepbackward.bind(this),this.onresizestart=r.prototype.onresizestart.bind(this),this.onresizemove=r.prototype.onresizemove.bind(this),this.onresizeend=r.prototype.onresizeend.bind(this),o.on(this.element(),o.eventType("start"),function(t){var e=o.target(t);o.parent(e)===this.element()&&(o.stop(t),o.supportsTouch()||o.cancel(t))}.bind(this)),o.supportsTouch()&&o.on(this.element(),"touchmove",o.cancel),o.on(this.deleteButtonElement(),"click",this.ondelete),o.on(this.stepForwardButtonElement(),"click",this.onstepforward),o.on(this.stepBackwardButtonElement(),"click",this.onstepbackward),o.draggable(this.resizeHandleElement(),this.onresizestart,this.onresizemove,this.onresizeend)},s);r.prototype.deleteButtonElement=function(){return o.child(this.element(),0)},r.prototype.stepForwardButtonElement=function(){return o.child(this.element(),1)},r.prototype.stepBackwardButtonElement=function(){return o.child(this.element(),2)},r.prototype.resizeHandleElement=function(){return o.child(this.element(),3)},r.prototype.redraw=function(){var t="translate("+this.x()+"px, "+this.y()+"px)";o.css(this.element(),{height:this.height()+"px",transform:t,visibility:this.visible()?"visible":"hidden",webkitTransform:t,width:this.width()+"px"}),this.stepForwardDisabled()?o.addClass(this.stepForwardButtonElement(),"disabled"):o.removeClass(this.stepForwardButtonElement(),"disabled"),this.stepBackwardDisabled()?o.addClass(this.stepBackwardButtonElement(),"disabled"):o.removeClass(this.stepBackwardButtonElement(),"disabled")},r.prototype.fitIn=function(t){this.x(t.x()),this.y(t.y()),this.width(t.width()),this.height(t.height())},r.prototype.keyEnabled=function(t){t?(o.on(document,"keydown",this.onmove),o.on(document,"keydown",this.ondelete)):(o.off(document,"keydown",this.onmove),o.off(document,"keydown",this.ondelete))},r.prototype.onmove=function(t){var e=o.which(t),n=r.keyMap[e];if(n)switch(o.cancel(t),n){case"left":this.mover(-1,0);break;case"up":this.mover(0,-1);break;case"right":this.mover(1,0);break;case"down":this.mover(0,1)}},r.prototype.ondelete=function(t){var e=o.type(t),n=o.which(t),i=r.keyMap[n],s="click"===e,a="keydown"===e&&("backspace"===i||"delete"===i);a&&o.cancel(t),(s||a)&&this.deleter()},r.prototype.onstepforward=function(){this.forwardStepper()},r.prototype.onstepbackward=function(){this.backwardStepper()},r.prototype.onresizestart=function(){this.resizer(0,0,!0,!1)},r.prototype.onresizemove=function(t,e){this.resizer(t,e,!1,!1)},r.prototype.onresizeend=function(t,e){this.resizer(t,e,!1,!0)},r.keyMap={8:"backspace",37:"left",38:"up",39:"right",40:"down",46:"delete"},"undefined"!=typeof e&&e.exports?e.exports=r:n.CanvasElementHandle=r}(this.app||(this.app={}))},{"../dom.js":11,"../helper.js":12,"./component.js":5}],3:[function(t,e,n){!function(n){"use strict";var i=n.helper||t("../helper.js"),o=n.dom||t("../dom.js"),s=n.Component||t("./component.js"),r=i.inherits(function(t){r.super_.call(this),this.srcText=this.prop(t.srcText),this.x=this.prop(t.x),this.y=this.prop(t.y),this.width=this.prop(t.width),this.height=this.prop(t.height),this.element=this.prop(t.element),this.parentElement=this.prop(t.parentElement),this.zIndex=this.prop("auto")},s);r.prototype.contains=function(t,e,n){var i=this.x(),o=this.y(),s=this.width(),r=this.height();return t>=i-n&&i+s+n>=t&&e>=o-n&&o+r+n>=e},r.prototype.redraw=function(){var t=this.element(),e=this.parentElement();if(!e&&t)return o.remove(t),void this.element(null);var n="translate("+this.x()+"px, "+this.y()+"px)";o.css(t,{transform:n,webkitTransform:n,zIndex:this.zIndex()})},r.load=function(t){return o.isURL(t.srcText)?h.load(t):a.load(t)};var a=i.inherits(function(t){a.super_.call(this,t),this.widthPerFontSize=this.prop(t.widthPerFontSize),this.heightPerFontSize=this.prop(t.heightPerFontSize),this.cache=this.prop({})},r);a.prototype.adjustSizeToKeepAspectRatio=function(){var t=this.cache(),e=this.widthPerFontSize(),n=this.heightPerFontSize(),i=Math.min(this.width()/e,this.height()/n);this.width(i*e),this.height(i*n),t.fontSize=i},a.prototype.redraw=function(){var t=this.cache();"fontSize"in t&&o.css(this.element(),{fontSize:t.fontSize+"px"}),a.super_.prototype.redraw.call(this),delete t.fontSize},a.load=function(t){var e=t.srcText,n=t.locator,s=t.sizer,r=t.parentElement;return Promise.resolve().then(function(){var t=o.el("<div>");e.split(/\r\n|\r|\n/g).forEach(function(e){e=i.escape(e).replace(/\s/g,"&nbsp;")||"&nbsp;";var n=o.el("<div>");o.html(n,e),o.append(t,n)}),o.addClass(t,"canvas-element");var h=20;o.css(t,{fontSize:h+"px"}),o.visible(t,!1),o.append(r,t);var p=o.rect(t),l=p.width,c=p.height,u=n({width:l,height:c}),d=new a({srcText:e,x:u.x,y:u.y,width:l,height:c,widthPerFontSize:l/h,heightPerFontSize:c/h,element:t,parentElement:r}),m=s({width:l,height:c});return(m.width!==l||m.height!==c)&&(d.width(m.width),d.height(m.height),d.adjustSizeToKeepAspectRatio()),d.redraw(),o.visible(t,!0),d})};var h=i.inherits(function(t){h.super_.call(this,t),this.aspectRatio=this.prop(t.aspectRatio)},r);h.prototype.adjustSizeToKeepAspectRatio=function(){var t=this.width(),e=this.height(),n=this.aspectRatio();t=Math.min(t,n*e),e=Math.min(e,t/n),this.width(t),this.height(e)},h.prototype.redraw=function(){o.css(this.element(),{width:this.width()+"px",height:this.height()+"px"}),h.super_.prototype.redraw.call(this)},h.load=function(t){var e=t.srcText,n=t.locator,i=t.sizer,s=t.parentElement;return new Promise(function(t,r){var a=o.el("<img>");o.addClass(a,"canvas-element"),o.src(a,e),o.visible(a,!1),o.on(a,"load",function(){var r=o.rect(a),p=r.width,l=r.height,c=p/l,u=o.rect(s),d=u.width,m=u.height;p>d&&(p=d,l=d/c),l>m&&(p=m*c,l=m);var f=n({width:p,height:l}),v=new h({srcText:e,x:f.x,y:f.y,width:p,height:l,aspectRatio:c,element:a,parentElement:s}),y=i({width:p,height:l});(y.width!==p||y.height!==l)&&(v.width(y.width),v.height(y.height),v.adjustSizeToKeepAspectRatio()),v.redraw(),o.visible(a,!0),t(v)}),o.on(a,"error",function(t){o.remove(a),r(t)}),o.append(s,a)})},"undefined"!=typeof e&&e.exports?e.exports=r:n.CanvasElement=r}(this.app||(this.app={}))},{"../dom.js":11,"../helper.js":12,"./component.js":5}],4:[function(t,e,n){!function(n){"use strict";var i=n.helper||t("../helper.js"),o=n.dom||t("../dom.js"),s=n.Component||t("./component.js"),r=n.Relation||t("./relation.js"),a=n.CanvasElement||t("./canvas-element.js"),h=n.CanvasElementHandle||t("./canvas-element-handle.js"),p=i.inherits(function(){p.super_.call(this)},i.List);p.prototype.fromPoint=function(t,e){for(var n=this.data,i=null,o=n.length-1;o>=0;o--){var s=n[o];if(s.contains(t,e,0))return s;!i&&s.contains(t,e,8)&&(i=s)}return i},p.prototype.swap=function(t,e){var n=this.data,i=n.length;if(!(0>t||t>=i||0>e||e>=i)){var o=n[t];n[t]=n[e],n[e]=o}},p.prototype.shiftRight=function(t){var e=this.data.indexOf(t);-1!==e&&this.swap(e,e+1)},p.prototype.shiftLeft=function(t){var e=this.data.indexOf(t);-1!==e&&this.swap(e,e-1)},p.prototype.canShiftRight=function(t){var e=this.data,n=e.indexOf(t);return-1!==n&&n!==e.length-1},p.prototype.canShiftLeft=function(t){var e=this.data.indexOf(t);return-1!==e&&0!==e};var l=i.inherits(function(t){this.canvas=this.prop(t.canvas),this.canvasElement=this.prop(t.canvasElement)},r);l.prototype.update=function(t){var e=this.canvasElement();if(t===e){var n=this.canvas(),i=n.width(),o=n.height(),s=e.x(),r=e.y(),a=e.width(),h=e.height(),p=20,l=Math.max(s,p-a),c=Math.max(r,p-h);l=Math.min(l,i-p),c=Math.min(c,o-p),e.x(l),e.y(c),n.hasCanvasElementHandle()&&n.selectedCanvasElement()===e&&n.canvasElementHandle().fitIn(e)}};var c=i.inherits(function(t){c.super_.call(this),this.canvasElementList=this.prop(new p),this.disabled=this.prop(!1),this.hasCanvasElementHandle=this.prop(t.hasCanvasElementHandle),this.element=this.prop(t.element),this.selectedCanvasElement=this.prop(null);var e;e=this.hasCanvasElementHandle()?new h({element:this.handleElement(),mover:c.prototype.canvasElementMover.bind(this),deleter:c.prototype.canvasElementDeleter.bind(this),forwardStepper:c.prototype.canvasElementForwardStepper.bind(this),backwardStepper:c.prototype.canvasElementBackwardStepper.bind(this),resizer:c.prototype.resizer.bind(this)}):null,this.canvasElementHandle=this.prop(e),this.dragContext=this.prop({});var n=c.prototype.onstart.bind(this),i=c.prototype.onmove.bind(this),s=c.prototype.onend.bind(this);o.draggable(this.element(),n,i,s),o.on(document,o.eventType("start"),function(){this.selectedCanvasElement(null),this.updateCanvasElementHandle()}.bind(this)),this.inserter=t.inserter;var r=c.prototype.ondrop.bind(this);o.droppable(this.element(),r),this.updater=t.updater,this.deleter=t.deleter},s);c.prototype.width=function(){return 640},c.prototype.height=function(){return 480},c.prototype.borderWidth=function(){return 5},c.prototype.containerElement=function(){return o.child(this.element(),0)},c.prototype.handleElement=function(){return o.child(this.element(),1)},c.prototype.redraw=function(){this.disabled()?o.addClass(this.element(),"disabled"):o.removeClass(this.element(),"disabled")},c.prototype.updateZIndex=function(){this.canvasElementList().toArray().forEach(function(t,e){t.zIndex(e)})},c.prototype.updateCanvasElementHandle=function(){if(this.hasCanvasElementHandle()){var t=this.selectedCanvasElement(),e=this.canvasElementHandle();if(t){var n=this.canvasElementList();e.stepForwardDisabled(!n.canShiftRight(t)),e.stepBackwardDisabled(!n.canShiftLeft(t)),e.fitIn(t),e.visible(!0),e.keyEnabled(!0)}else e.visible(!1),e.keyEnabled(!1)}},c.prototype.stopKeyEventOnCanvasElementHandle=function(){if(this.hasCanvasElementHandle()){var t=this.canvasElementHandle();t.visible()&&t.keyEnabled(!1)}},c.prototype.restartKeyEventOnCanvasElementHandle=function(){if(this.hasCanvasElementHandle()){var t=this.canvasElementHandle();t.visible()&&t.keyEnabled(!0)}},c.prototype.loadCanvasElement=function(t,e,n){return a.load({srcText:t,locator:e,sizer:n,parentElement:this.containerElement()}).then(function(t){this.canvasElementList().add(t);var e=new l({canvas:this,canvasElement:t});return t.relations().push(e),this.selectedCanvasElement(t),this.updateCanvasElementHandle(),this.updateZIndex(),t}.bind(this))},c.prototype.loadCanvasElementAll=function(t){return Promise.all(t.map(function(t){var e=t.srcText,n={x:t.x,y:t.y},i={width:t.width,height:t.height};return a.load({srcText:e,locator:function(){return n},sizer:function(){return i},parentElement:this.containerElement()})}.bind(this))).then(function(t){return t.forEach(function(t){this.canvasElementList().add(t);var e=new l({canvas:this,canvasElement:t});t.relations().push(e)}.bind(this)),this.updateZIndex(),t}.bind(this))},c.prototype.getCanvasElementPropsList=function(){return this.canvasElementList().toArray().map(function(t){return{srcText:t.srcText(),x:t.x(),y:t.y(),width:t.width(),height:t.height()}})},c.prototype.deleteCanvasElement=function(t){t&&(this.selectedCanvasElement()===t&&(this.selectedCanvasElement(null),this.updateCanvasElementHandle()),t.relations([]),t.parentElement(null),this.canvasElementList().remove(t),this.updateZIndex())},c.prototype.canvasElementMover=function(t,e){var n=this.selectedCanvasElement();n.x(n.x()+t),n.y(n.y()+e)},c.prototype.canvasElementDeleter=function(){this.deleteCanvasElement(this.selectedCanvasElement()),this.deleter()},c.prototype.canvasElementForwardStepper=function(){this.canvasElementList().shiftRight(this.selectedCanvasElement()),this.updateCanvasElementHandle(),this.updateZIndex(),this.updater()},c.prototype.canvasElementBackwardStepper=function(){this.canvasElementList().shiftLeft(this.selectedCanvasElement()),this.updateCanvasElementHandle(),this.updateZIndex(),this.updater()},c.prototype.resizer=function(){var t={};return function(e,n,i,o){var s;if(i)return s=this.selectedCanvasElement(),t.canvasElement=s,t.width=s.width(),t.height=s.height(),void this.stopKeyEventOnCanvasElementHandle();s=t.canvasElement;var r=s.width()/s.height(),a=Math.max(t.width+e,12*r,12),h=Math.max(t.height+n,12/r,12);s.width(a),s.height(h),s.adjustSizeToKeepAspectRatio(),o&&(this.restartKeyEventOnCanvasElementHandle(),(0!==e||0!==n)&&this.updater())}}(),c.prototype.onstart=function(t,e,n){var i=o.supportsTouch();i||o.cancel(n),o.removeFocus();var s=this.borderWidth();t-=s,e-=s;var r=this.dragContext(),a=this.canvasElementList().fromPoint(t,e);r.canvasElement=a,a&&(i&&o.cancel(n),o.stop(n),this.selectedCanvasElement(a),this.updateCanvasElementHandle(),this.stopKeyEventOnCanvasElementHandle(),r.x=a.x(),r.y=a.y())},c.prototype.onmove=function(t,e){var n=this.dragContext(),i=n.canvasElement;i&&(i.x(n.x+t),i.y(n.y+e))},c.prototype.onend=function(t,e){var n=this.dragContext().canvasElement;n&&(this.restartKeyEventOnCanvasElementHandle(),(0!==t||0!==e)&&this.updater())},c.prototype.ondrop=function(t,e,n){var i=this.borderWidth();t-=i,e-=i,this.inserter(o.getImageURLData(n)||o.getTextData(n),t,e)},"undefined"!=typeof e&&e.exports?e.exports=c:n.Canvas=c}(this.app||(this.app={}))},{"../dom.js":11,"../helper.js":12,"./canvas-element-handle.js":2,"./canvas-element.js":3,"./component.js":5,"./relation.js":9}],5:[function(t,e,n){!function(n){"use strict";var i=n.helper||t("../helper.js"),o=n.dom||t("../dom.js"),s=function(){this.relations=this.prop([])};s.prototype.prop=function(t,e,n){"function"!=typeof n&&(n=i.identity);var o=n(t,e);return function(t){return"undefined"==typeof t?o:void(t!==o&&(o=n(t,o),this.markDirty()))}},s.prototype.redraw=function(){},s.prototype.markDirty=function(){var t=[],e=null,n=function(e){for(var i=e,o=t.length;o>i;i++){var s=t[i];s.relations().forEach(function(t){t.update(s)})}t.length>o&&n(o)},i=function(){n(0),t.forEach(function(t){t.redraw()}),t=[],e=null};return function(){o.unsupported()||(-1===t.indexOf(this)&&t.push(this),null===e&&(e=o.animate(i)))}}(),"undefined"!=typeof e&&e.exports?e.exports=s:n.Component=s}(this.app||(this.app={}))},{"../dom.js":11,"../helper.js":12}],6:[function(t,e,n){!function(n){"use strict";var i=n.helper||t("../helper.js"),o=n.dom||t("../dom.js"),s=n.Component||t("./component.js"),r=i.inherits(function(t){r.super_.call(this),this.disabled=this.prop(!1),this.element=this.prop(t.element),this.inserter=t.inserter,o.on(this.textElement(),"input",r.prototype.oninput.bind(this)),o.on(this.buttonElement(),"click",r.prototype.onclick.bind(this)),this.markDirty()},s);r.prototype.textElement=function(){return o.child(this.element(),0)},r.prototype.buttonElement=function(){return o.child(this.element(),1)},r.prototype.clearText=function(){o.value(this.textElement(),"")},r.prototype.redraw=function(){var t=this.disabled(),e=this.textElement(),n=o.value(e);o.disabled(e,t),o.disabled(this.buttonElement(),t||!n)},r.prototype.oninput=function(t){this.markDirty()},r.prototype.onclick=function(){var t=o.value(this.textElement());this.inserter(t)},"undefined"!=typeof e&&e.exports?e.exports=r:n.InsertForm=r}(this.app||(this.app={}))},{"../dom.js":11,"../helper.js":12,"./component.js":5}],7:[function(t,e,n){!function(n){"use strict";var i=n.helper||t("../helper.js"),o=n.dom||t("../dom.js"),s=n.Component||t("./component.js"),r=i.inherits(function(t){r.super_.call(this),this.title=this.prop(""),this.url=this.prop(""),this.visible=this.prop(!1),this.element=this.prop(t.element),o.on(this.urlTextElement(),"click",function(t){o.selectAll(o.currentTarget(t))}),this.closer=t.closer;var e=r.prototype.onclose.bind(this);o.on(this.element(),o.eventType("start"),e),o.on(this.closeButtonElement(),"click",e)},s);r.prototype.contentElement=function(){return o.child(this.element(),0,0)},r.prototype.urlTextElement=function(){return o.child(this.element(),0,0,0,0,0)},r.prototype.openLinkElement=function(){return o.child(this.element(),0,0,1,0,0)},r.prototype.emailLinkElement=function(){return o.child(this.element(),0,0,1,1,0)},r.prototype.twitterLinkElement=function(){return o.child(this.element(),0,0,1,2,0)},r.prototype.facebookLinkElement=function(){return o.child(this.element(),0,0,1,3,0)},r.prototype.closeButtonElement=function(){return o.child(this.element(),0,1)},r.prototype.redraw=function(){if(this.visible()){var t=this.title(),e=this.url(),n=encodeURIComponent(t),i=encodeURIComponent(e);o.value(this.urlTextElement(),e),o.href(this.openLinkElement(),e),o.href(this.emailLinkElement(),"mailto:?subject="+n+"&body=%0A%0A"+i),o.href(this.twitterLinkElement(),"https://twitter.com/share?text="+n+"&url="+i),o.href(this.facebookLinkElement(),"https://www.facebook.com/sharer/sharer.php?u="+i),o.resetScroll(this.contentElement()),o.resetScroll(this.urlTextElement()),o.addClass(o.body(),"unscrollable"),o.on(o.doc(),"touchmove",o.cancel),o.removeClass(this.element(),"hide"),o.supportsTouch()||o.selectAll(this.urlTextElement())}else o.removeClass(o.body(),"unscrollable"),o.off(o.doc(),"touchmove",o.cancel),o.addClass(this.element(),"hide"),o.supportsTouch()&&o.clearSelection()},r.prototype.onclose=function(t){o.target(t)===o.currentTarget(t)&&("touchstart"===o.type(t)&&o.cancel(t),this.closer())},"undefined"!=typeof e&&e.exports?e.exports=r:n.PublishDialog=r}(this.app||(this.app={}))},{"../dom.js":11,"../helper.js":12,"./component.js":5}],8:[function(t,e,n){!function(n){"use strict";var i=n.helper||t("../helper.js"),o=n.dom||t("../dom.js"),s=n.Component||t("./component.js"),r=i.inherits(function(t){r.super_.call(this),this.publishDisabled=this.prop(!0),this.element=this.prop(t.element),this.updater=t.updater,this.publisher=t.publisher,o.on(this.textElement(),"input",r.prototype.oninput.bind(this)),o.on(this.buttonElement(),"click",r.prototype.onclick.bind(this))},s);r.prototype.textElement=function(){return o.child(this.element(),0)},r.prototype.buttonElement=function(){return o.child(this.element(),1)},r.prototype.text=function(t){return"undefined"!=typeof t&&this.markDirty(),o.value(this.textElement(),t)},r.prototype.redraw=function(){o.disabled(this.buttonElement(),this.publishDisabled())},r.prototype.oninput=function(){this.markDirty(),this.updater()},r.prototype.onclick=function(){this.publisher(this.text())},"undefined"!=typeof e&&e.exports?e.exports=r:n.PublishForm=r}(this.app||(this.app={}))},{"../dom.js":11,"../helper.js":12,"./component.js":5}],9:[function(t,e,n){!function(t){"use strict";var n=function(){};n.prototype.prop=function(t){var e=t;return function(t){return"undefined"==typeof t?e:void(e=t)}},n.prototype.update=function(){},"undefined"!=typeof e&&e.exports?e.exports=n:t.Relation=n}(this.app||(this.app={}))},{}],10:[function(t,e,n){!function(n){"use strict";var i=n.helper||t("../helper.js"),o=n.dom||t("../dom.js"),s=n.Component||t("./component.js"),r=i.inherits(function(){r.super_.call(this),this.fragment=this.prop(o.urlFragment())},s);r.prototype.redraw=function(){o.urlFragment(this.fragment())},"undefined"!=typeof e&&e.exports?e.exports=r:n.URLComponent=r}(this.app||(this.app={}))},{"../dom.js":11,"../helper.js":12,"./component.js":5}],11:[function(t,e,n){!function(t){"use strict";var n={};n.unsupported=function(){return"undefined"==typeof document},n.el=function(t){return"<"===t.charAt(0)?(t=t.match(/<(.+)>/)[1],document.createElement(t)):document.querySelector(t)},n.doc=function(){return document},n.body=function(){return document.body},n.title=function(t){document.title=t},n.append=function(t,e){t.appendChild(e)},n.remove=function(t){t.parentNode.removeChild(t)},n.child=function(t,e){var n=arguments.length;if(2===n)return t.children[e];for(var i=1;n>i;i++)e=arguments[i],t=t.children[e];return t},n.parent=function(t){return t.parentNode},n.css=function(t,e){var n=t.style;for(var i in e)n[i]=e[i]},n.addClass=function(t,e){t.classList.add(e)},n.removeClass=function(t,e){t.classList.remove(e)},n.html=function(t,e){t.innerHTML=e},n.value=function(t,e){return"undefined"==typeof e?t.value:void(t.value=e)},n.href=function(t,e){t.setAttribute("href",e)},n.src=function(t,e){t.src=e},n.disabled=function(t,e){t.disabled=e},n.visible=function(t,e){t.style.visibility=e?"visible":"hidden"},n.rect=function(t){return t.getBoundingClientRect()},n.scrollLeft=function(t){return t.scrollLeft},n.scrollTop=function(t){return t.scrollTop},n.resetScroll=function(t){t.scrollTop=0},n.removeFocus=function(){document.activeElement.blur()},n.selectAll=function(t){t.setSelectionRange(0,t.value.length)},n.clearSelection=function(){window.getSelection().removeAllRanges()},n.on=function(t,e,n){t.addEventListener(e,n)},n.off=function(t,e,n){t.removeEventListener(e,n)},n.animate=function(t){return window.requestAnimationFrame(t)},n.isURL=function(t){try{new URL(t)}catch(e){return!1}return!0},n.urlOrigin=function(){return location.protocol+"//"+location.host},n.urlPathName=function(){return location.pathname},n.urlFragment=function(t){return"undefined"==typeof t?location.hash.substring(1):void location.replace("#"+t)},n.supportsTouch=function(){return"createTouch"in document},n.target=function(t){return n.supportsTouch()&&"changedTouches"in t&&(t=t.changedTouches[0]),t.target},n.currentTarget=function(t){return t.currentTarget},n.type=function(t){return t.type},n.which=function(t){return t instanceof KeyboardEvent?t.which:null},n.pagePoint=function(t,e){return n.supportsTouch()&&(t=t.changedTouches[0]),{x:t.pageX-(e?e.x:0),y:t.pageY-(e?e.y:0)}},n.clientPoint=function(t,e){return n.supportsTouch()&&(t=t.changedTouches[0]),{x:t.clientX-(e?e.x:0),y:t.clientY-(e?e.y:0)}},n.cancel=function(t){t.preventDefault()},n.stop=function(t){t.stopPropagation()},n.eventType=function(t){var e=n.supportsTouch();switch(t){case"start":return e?"touchstart":"mousedown";case"move":return e?"touchmove":"mousemove";case"end":return e?"touchend":"mouseup"}},n.draggable=function(){var t=function(t){this.el=t.el,this.onstart=t.onstart,this.onmove=t.onmove,this.onend=t.onend,this.start=e.bind(this),this.move=i.bind(this),this.end=o.bind(this),this.lock=!1,this.startingPoint=null,n.on(this.el,n.eventType("start"),this.start)},e=function(t){if(!this.lock){this.lock=!0,this.startingPoint=n.pagePoint(t);var e=this.el,i=this.onstart,o=n.rect(e),s=n.clientPoint(t,{x:o.left-n.scrollLeft(e),y:o.top-n.scrollTop(e)});"function"==typeof i&&i(s.x,s.y,t),n.on(document,n.eventType("move"),this.move),n.on(document,n.eventType("end"),this.end)}},i=function(t){var e=this.onmove,i=n.pagePoint(t,this.startingPoint);"function"==typeof e&&e(i.x,i.y,t)},o=function(t){n.off(document,n.eventType("move"),this.move),n.off(document,n.eventType("end"),this.end);var e=this.onend,i=n.pagePoint(t,this.startingPoint);"function"==typeof e&&e(i.x,i.y,t),this.lock=!1};return function(e,n,i,o){new t({el:e,onstart:n,onmove:i,onend:o})}}(),n.droppable=function(t,e){n.on(t,"dragover",n.cancel),n.on(t,"drop",function(i){n.cancel(i);var o=n.rect(t),s=n.clientPoint(i,{x:o.left-n.scrollLeft(t),y:o.top-n.scrollTop(t)});e(s.x,s.y,i)})},n.getTextData=function(t){return t.dataTransfer.getData("text")},n.getImageURLData=function(t){var e=t.dataTransfer,n=e.types;if(!n)return null;var i=Array.prototype.indexOf;if(-1!==i.call(n,"text/uri-list")&&-1!==i.call(n,"text/html")){var o=e.getData("text/html"),s=o.match(/<img.*?src=(["\'])(.+?)\1.*?>/i);if(s)return s[2]}return null},n.btoa=function(t){return window.btoa(escape(encodeURIComponent(t))).replace(/[+\/]/g,function(t){switch(t){case"+":return"-";case"/":return"_"}})},n.atob=function(t){return decodeURIComponent(unescape(window.atob(t.replace(/[-_]/g,function(t){switch(t){case"-":return"+";case"_":return"/"}}))))},"undefined"!=typeof e&&e.exports?e.exports=n:t.dom=n}(this.app||(this.app={}))},{}],12:[function(t,e,n){!function(t){"use strict";var n={};n.inherits=function(t,e){return t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),t},n.identity=function(t){return t},n.escape=function(t){return t.replace(/[&<>"']/g,function(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#039;"}})},n.List=function(){var t=function(){this.data=[]};return t.prototype.add=function(t){this.contains(t)||this.data.push(t)},t.prototype.remove=function(t){for(var e=this.data,n=e.length-1;n>=0;n--)if(this.equal(e[n],t)){e.splice(n,1);break}},t.prototype.contains=function(t){return this.data.some(function(e){return this.equal(e,t)}.bind(this))},t.prototype.equal=function(t,e){return t===e},t.prototype.toArray=function(){return this.data.slice()},t}(),n.bindAll=function(t){var e=Object.getPrototypeOf(t);for(var n in e)t[n]=e[n].bind(t)},"undefined"!=typeof e&&e.exports?e.exports=n:t.helper=n}(this.app||(this.app={}))},{}]},{},[1]);